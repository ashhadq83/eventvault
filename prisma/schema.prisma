// ============================================
// EVENTVAULT - Banquet Hall Management System
// Database Schema Design
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // URL is in prisma.config.ts
}

// ======================
// ENUMS (Fixed value sets)
// ======================

enum UserRole {
  STAFF
  ADMIN
  SUPER_ADMIN
}

enum BookingStatus {
  INQUIRY
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PARTIAL
  PAID
  REFUNDED
  CANCELLED
}

// ======================
// MODELS (Database Tables)
// ======================

// User Model - Staff, Admin, Super Admin
model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String
  passwordHash String    @map("password_hash")
  role         UserRole  @default(STAFF)
  phone        String?
  
  // Relationships
  venueId      String?
  venue        Venue?    @relation(fields: [venueId], references: [id])
  bookings     Booking[] @relation("createdBy") // Added: opposite relation
  
  // Timestamps
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  @@map("users")
}

// Venue Model - Banquet halls, event spaces
model Venue {
  id          String    @id @default(cuid())
  name        String
  location    String    // "Calgary, AB", "Okotoks, AB"
  description String?
  capacity    Int
  
  // Pricing
  basePrice   Float     @map("base_price")
  peakMultiplier   Float?   @default(1.5) @map("peak_multiplier")
  weekendMultiplier Float?   @default(1.3) @map("weekend_multiplier")
  
  // Relationships
  users       User[]
  rooms       Room[]
  bookings    Booking[]
  
  // Timestamps
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  @@map("venues")
}

// Room Model - Sub-spaces within a venue
model Room {
  id        String   @id @default(cuid())
  name      String   // "Main Hall", "Garden Area", "Conference Room A"
  capacity  Int
  venueId   String
  venue     Venue    @relation(fields: [venueId], references: [id])
  bookings  Booking[] // Added: opposite relation
  
  // Unique constraint: Room names must be unique within a venue
  @@unique([venueId, name])
  @@map("rooms")
}

// Client Model - CRM for event organizers
model Client {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String
  phone     String?
  company   String?
  address   String?
  city      String?
  province  String?   // "AB", "BC", etc.
  
  // CRM fields
  notes     String?
  preferences String? // JSON string of preferences
  
  // Relationships
  bookings  Booking[]
  
  // Timestamps
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  
  @@map("clients")
}

// Booking Model - Core business entity
model Booking {
  id          String        @id @default(cuid())
  title       String        // "Wedding Reception", "Corporate Conference"
  description String?
  
  // Date & Time
  startDate   DateTime      @map("start_date")
  endDate     DateTime      @map("end_date")
  durationHours Float       @map("duration_hours") // Calculated field
  
  // Relationships
  venueId     String
  venue       Venue         @relation(fields: [venueId], references: [id])
  
  roomId      String?
  room        Room?         @relation(fields: [roomId], references: [id])
  
  clientId    String?
  client      Client?       @relation(fields: [clientId], references: [id])
  
  createdById String        @map("created_by_id")
  createdBy   User          @relation(fields: [createdById], references: [id], name: "createdBy")
  
  // Opposite relations
  invoice     Invoice?      // Added: opposite relation
  
  // Status & Financials
  status      BookingStatus @default(INQUIRY)
  totalAmount Float         @map("total_amount")
  depositPaid Float         @default(0) @map("deposit_paid")
  
  // Catering (simplified for now)
  cateringRequired Boolean  @default(false) @map("catering_required")
  cateringNotes    String?  @map("catering_notes")
  
  // Timestamps
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  
  @@map("bookings")
}

// Invoice Model - Payments and billing
model Invoice {
  id          String        @id @default(cuid())
  bookingId   String        @unique
  booking     Booking       @relation(fields: [bookingId], references: [id])
  
  amount      Float
  paidAmount  Float         @default(0) @map("paid_amount")
  status      PaymentStatus @default(PENDING)
  
  // Payment details
  stripePaymentId String?   @map("stripe_payment_id")
  paymentMethod   String?   @map("payment_method")
  
  // Timestamps
  issuedAt    DateTime      @default(now()) @map("issued_at")
  dueDate     DateTime      @map("due_date")
  paidAt      DateTime?     @map("paid_at")
  
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  
  @@map("invoices")
}